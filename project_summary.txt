# 1. Project Details

This project is a custom Intrusion Detection System (IDS) written in C. It's designed for educational purposes to demonstrate how an IDS can capture, parse, and analyze network packets based on user-defined rules.

**Core Components:**
*   **Packet Capture:** Uses the `libpcap` library to capture live network traffic or read from `.pcap` files.
*   **Custom Scripting Language (DSL):** A simple, custom-built language for writing detection rules (e.g., `if tcp.syn then alert("Scan detected")`).
*   **Lexer & Parser:** A hand-written lexer (tokenizer) and a recursive descent parser that build an Abstract Syntax Tree (AST) from the DSL rules. This avoids external tools like Flex or Bison.
*   **Interpreter:** An engine that evaluates the AST against captured packets and executes actions (like `alert` or `log`).

**File Structure:**
*   `src/`: Contains all the C source code (`.c`) and header files (`.h`).
*   `rules/`: Contains the DSL rule files (`.dsl`, `.mylang`).
*   `bin/`: Contains the compiled executable (`ids`).
*   `obj/`: Contains intermediate object files generated during compilation.
*   `Makefile`: The build script for the project.
*   `README.md`: The original detailed documentation for the project.
*   `GEMINI.md`: A summary file for AI interaction.

# 2. What to Do Next: Implement Real Packet Capture

The core engine (parser, interpreter) is now working with a functional command-line interface. The next critical step is to replace the dummy packet simulation with **real packet capture**.

Here is the step-by-step plan to achieve this:

**Step 1: Create `packet.c`**
*   Create a new file `src/packet.c`. This will contain the logic for using the `libpcap` library.
*   The existing `src/packet.h` will need to be updated to declare the functions you create in `packet.c`.

**Step 2: Implement Packet Capture Functions in `packet.c`**
*   **Create a `start_capture` function:** This function should take the network interface name (e.g., "eth0") as an argument. Inside, it will use `pcap_open_live()` to start a capture session.
*   **Create a `process_pcap_file` function:** This function will take a pcap file path as an argument and use `pcap_open_offline()` to read from it.
*   **Create a packet handler callback:** Both of the functions above will use `pcap_loop()` to process packets. `pcap_loop()` requires a callback function (e.g., `void got_packet(u_char *args, const struct pcap_pkthdr *header, const u_char *packet)`). This callback is the heart of the IDS.

**Step 3: Integrate with `main.c`**
*   In `main.c`, `#include "packet.h"`.
*   Call your new `start_capture` or `process_pcap_file` function based on whether the user provided the `-i` or `-f` flag.
*   You will need to pass the `ASTNode *root` to your capture functions so the callback can access the rules.

**Step 4: Implement the Interpreter Callback Logic**
*   Inside the `got_packet` callback in `packet.c`, you will receive the raw packet data.
*   You will need to parse this raw data to extract information (e.g., is it a TCP packet? Is the SYN flag set?).
*   You will then pass this structured packet information to the `eval()` function (our interpreter) along with the AST. The `eval()` function will then check the rules against a real packet instead of a dummy one.

# 3. Suggestions for This Project

*   **Improve the Makefile:** Enhance the `Makefile` by adding standard targets like `clean` (to remove compiled files) and `install` (to copy the executables to a system-wide location like `/usr/local/bin`).
*   **Add a Testing Framework:** Create a `tests/` directory and integrate a unit testing framework for C (like CUnit or Check). Write tests for the lexer, parser, and interpreter to ensure they work correctly and to prevent regressions.
*   **Enhance the DSL:**
    *   Add support for variables to store state between packets.
    *   Implement more complex data types (e.g., IP address ranges).
    *   Add more built-in functions for packet inspection.
*   **Improve Error Handling:** Make the parser and interpreter provide more detailed error messages with line numbers when they encounter invalid syntax in a rule file.
*   **Implement Bytecode VM:** As mentioned in the `README.md` stretch goals, compiling the DSL to bytecode instead of interpreting the AST directly would significantly improve performance. This is a challenging but very rewarding extension.
*   **Add Configuration File:** Instead of passing all options as command-line arguments, create a configuration file (e.g., `config.yaml` or `ids.conf`) to specify the network interface, rule files, and other settings.
